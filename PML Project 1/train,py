import pandas as pd
from sklearn.model_selection import train_test_split
import numpy as np
import matplotlib.pyplot as plt
from sklearn.ensemble import RandomForestClassifier
from sklearn.tree import DecisionTreeClassifier
from sklearn.neural_network import MLPClassifier
from sklearn import metrics
from sklearn.model_selection import StratifiedKFold
from statistics import mean
import joblib

features_df = pd.read_csv('features.csv')
# mag_person1 = features_df.loc[features_df['label'] == 4]['magnitude']
# mag_person2 = features_df.loc[features_df['label'] == 6]['magnitude']

# plt.plot(range(450), mag_person1, color = 'r', label = 'person 3')
# plt.plot(range(450), mag_person2, color = 'b', label = 'person 2')
# plt.xlabel('samples')
# plt.ylabel('magnitude')
# plt.legend()
# plt.show()

labels = features_df['label']
data = features_df.drop(columns = ['label'])
data = data.set_index('id')

cross_validator = StratifiedKFold(n_splits = 10, shuffle = True)
accuracies = []
rfc = RandomForestClassifier(n_estimators = 512)
#dt = DecisionTreeClassifier()
#mlpc = MLPClassifier(max_iter = 1000, activation = 'relu')

for i, (train_idx, test_idx) in enumerate(cross_validator.split(data, labels)):
    rfc.fit(data.iloc[train_idx], labels.iloc[train_idx])
    accuracies.append(rfc.score(data.iloc[test_idx], labels.iloc[test_idx]))
    print(f'Fold {i} done')

print(f'Possible model accuracies: {accuracies}')
print('Maximum accuracy: {:.4f}%'.format(max(accuracies) * 100))
print('Minimum accuracy: {:.4f}%'.format(min(accuracies) * 100))
print('Overall accuracy: {:.4f}%'.format(mean(accuracies) * 100))


# submission
testdata_df = pd.read_csv('features_test.csv')
testdata_df = testdata_df.set_index('id')
labels_pred_test = rfc.predict(testdata_df)

submission_df = pd.DataFrame()
rows = []
for id, label in zip(testdata_df.index, labels_pred_test):
    rows.append({
        'id': id,
        'class': label
    })
submission_df = pd.concat([submission_df, pd.DataFrame(rows)], axis = 0)
submission_df.to_csv('submission.csv', index = False)



#Try no 1: 12 features: mean x,y,z; medioan x,y,z; cross cor xy;yz (since z has little to no variance); magnitude; avg distance from mean x;y;z
#accuracy for test is ~0.9+-0.1 and for test submission 0.779 ‚ùå